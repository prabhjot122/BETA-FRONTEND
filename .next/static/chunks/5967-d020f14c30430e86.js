"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5967],{170:(e,t,r)=>{r.d(t,{G1:()=>l,Uj:()=>u,hD:()=>n,rY:()=>c,uE:()=>i});var a=r(9509);let s={BASE_URL:void 0!==a&&a.env.NEXT_PUBLIC_API_URL||"http://localhost:8000",TIMEOUT:5e3,RETRY_ATTEMPTS:3};class o{getAuthHeaders(){let e=localStorage.getItem("authToken");return e?{Authorization:"Bearer ".concat(e)}:{}}async makeRequest(e){let{method:t,url:r,data:a,params:s,headers:o={}}=e,i=new URL(r.startsWith("/")?r.slice(1):r,this.baseURL.endsWith("/")?this.baseURL:this.baseURL+"/"),u="GET"===t?"".concat(t,":").concat(i.toString()):null;if(u&&this.rateLimitingEnabled){let e=this.lastRequestTime.get(u),a=Date.now(),s=this.minRequestInterval;if(r.includes("/leaderboard/around-me")&&(s=100),e&&a-e<s)return console.log("⏱️ Rate limited: ".concat(t," ").concat(i.toString())),Promise.reject(new n("Rate limited: too many requests",429));this.lastRequestTime.set(u,a)}if(!this.rateLimitingEnabled&&this.lastRequestTime.size>3&&(this.rateLimitingEnabled=!0,console.log("\uD83D\uDD12 Rate limiting enabled after initial load")),u&&this.requestCache.has(u))return console.log("\uD83D\uDD04 Using cached request: ".concat(t," ").concat(i.toString())),this.requestCache.get(u);s&&Object.keys(s).forEach(e=>{void 0!==s[e]&&null!==s[e]&&i.searchParams.append(e,s[e].toString())});let c={method:t,headers:{"Content-Type":"application/json",...this.getAuthHeaders(),...o},signal:AbortSignal.timeout(this.timeout)};a&&("POST"===t||"PUT"===t)&&(c.body=JSON.stringify(a));let l=this.executeRequest(i.toString(),c,t);return u&&(this.requestCache.set(u,l),l.finally(()=>{setTimeout(()=>{this.requestCache.delete(u)},3e4)})),l}async executeRequest(e,t,r){try{let r,a=await fetch(e,t),s=a.headers.get("content-type");if(r=(null==s?void 0:s.includes("application/json"))?await a.json():(null==s?void 0:s.includes("text/"))?await a.text():await a.blob(),!a.ok){console.error("❌ API Error: ".concat(a.status," ").concat(a.statusText),r);let e="HTTP ".concat(a.status);throw r&&(r.error&&r.error.message?e=r.error.message:r.detail?e=r.detail:r.message?e=r.message:"string"==typeof r&&(e=r)),Error(e)}return{data:r,status:a.status}}catch(t){if(console.error("\uD83D\uDCA5 API Request Failed: ".concat(r," ").concat(e),t),t instanceof n)throw t;if(t instanceof TypeError&&t.message.includes("Failed to fetch"))throw console.warn("\uD83C\uDF10 Network error for ".concat(e,", this might be a CORS or connectivity issue")),new n("Network connection failed. Please check your internet connection.",0,t);if(t instanceof Error&&t.message.includes("ERR_INSUFFICIENT_RESOURCES"))throw console.warn("⚠️ Too many requests for ".concat(e,", implementing backoff")),new n("Too many requests. Please wait a moment and try again.",429,t);if(t instanceof DOMException&&"TimeoutError"===t.name)throw console.warn("⏰ Request timeout for ".concat(e)),new n("Request timed out. Please try again.",408,t);throw new n(t instanceof Error?t.message:"Network error occurred",0,t)}}async get(e,t,r){return this.makeRequest({method:"GET",url:e,params:t,headers:r})}async post(e,t,r){return this.makeRequest({method:"POST",url:e,data:t,headers:r})}async put(e,t,r){return this.makeRequest({method:"PUT",url:e,data:t,headers:r})}async delete(e,t){return this.makeRequest({method:"DELETE",url:e,headers:t})}constructor(e=s.BASE_URL,t=s.TIMEOUT){this.requestCache=new Map,this.lastRequestTime=new Map,this.minRequestInterval=200,this.rateLimitingEnabled=!1,this.baseURL=e,this.timeout=t}}class n extends Error{constructor(e,t,r){super(e),this.name="ApiError",this.status=t,this.details=r}}let i=new o,u=async e=>{try{return(await e()).data}catch(e){throw(e=>e instanceof n?e:e instanceof Error?new n(e.message,0):new n("Unknown error occurred",0))(e)}},c="true"===(void 0!==a&&a.env.NEXT_PUBLIC_MOCK_MODE),l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;return new Promise(t=>setTimeout(t,e))}},5967:(e,t,r)=>{r.d(t,{y:()=>o});var a=r(170);class s{async signup(e){if(a.rY){if(await (0,a.G1)(),e.email===this.MOCK_ADMIN.email)throw Error("Email already registered");return{user_id:Math.floor(1e3*Math.random())+2,name:e.name,email:e.email,created_at:new Date().toISOString(),total_points:0,shares_count:0,current_rank:void 0,is_admin:!1}}let t=await (0,a.Uj)(()=>a.uE.post("/auth/signup",e));return t.user_id&&(localStorage.setItem("userData",JSON.stringify(t)),console.log("✅ User data stored after signup:",t)),t}async login(e){if(a.rY){if(await (0,a.G1)(),e.email===this.MOCK_ADMIN.email&&e.password===this.MOCK_ADMIN.password){let e="mock-jwt-token-"+Date.now();return localStorage.setItem("authToken",e),localStorage.setItem("userData",JSON.stringify(this.MOCK_ADMIN.user)),{access_token:e,token_type:"bearer",expires_in:3600}}throw Error("Invalid email or password")}let t=await (0,a.Uj)(()=>a.uE.post("/auth/login",e));if(t.access_token){localStorage.setItem("authToken",t.access_token);try{let e=await this.getCurrentUser();localStorage.setItem("userData",JSON.stringify(e))}catch(e){console.warn("Failed to fetch user data after login:",e)}}return t}async getCurrentUser(){if(a.rY){await (0,a.G1)(200);let e=localStorage.getItem("userData");if(e)return JSON.parse(e);throw Error("User not authenticated")}return(0,a.Uj)(()=>a.uE.get("/auth/me"))}async updateProfile(e){if(a.rY){await (0,a.G1)();let t=localStorage.getItem("userData");if(!t)throw Error("User not authenticated");let r={...JSON.parse(t),...e};return localStorage.setItem("userData",JSON.stringify(r)),r}return(0,a.Uj)(()=>a.uE.put("/users/profile",e))}logout(){localStorage.removeItem("authToken"),localStorage.removeItem("userData")}isAuthenticated(){let e=localStorage.getItem("authToken"),t=localStorage.getItem("userData");return!!(e&&t)}isAdmin(){let e=localStorage.getItem("userData");if(!e)return!1;try{let t=JSON.parse(e);return!0===t.is_admin}catch(e){return!1}}getStoredUser(){let e=localStorage.getItem("userData");if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}async refreshToken(){if(a.rY){if(await (0,a.G1)(),!this.isAuthenticated())throw Error("User not authenticated");let e="mock-jwt-token-"+Date.now();return localStorage.setItem("authToken",e),{access_token:e,token_type:"bearer",expires_in:3600}}return(0,a.Uj)(()=>a.uE.post("/auth/refresh"))}async validateToken(){if(!this.isAuthenticated())return null;try{return await this.getCurrentUser()}catch(e){return this.logout(),null}}async forgotPassword(e){if(a.rY){if(await (0,a.G1)(1e3),!e||!e.includes("@"))throw Error("Please enter a valid email address");return{message:"Password reset instructions have been sent to your email address.",success:!0}}let t={email:e};return(0,a.Uj)(()=>a.uE.post("/auth/forgot-password",t))}async resetPassword(e,t){if(a.rY){if(await (0,a.G1)(1e3),!e)throw Error("Invalid or expired reset token");if(!t||t.length<6)throw Error("Password must be at least 6 characters long");return{message:"Your password has been successfully reset. You can now log in with your new password.",success:!0}}let r={token:e,new_password:t};return(0,a.Uj)(()=>a.uE.post("/auth/reset-password",r))}async changePassword(e,t){if(a.rY){if(await (0,a.G1)(800),!this.isAuthenticated())throw Error("User not authenticated");if(!e)throw Error("Current password is required");if(!t||t.length<6)throw Error("New password must be at least 6 characters long");return{message:"Password changed successfully",success:!0}}return(0,a.Uj)(()=>a.uE.post("/users/change-password",{current_password:e,new_password:t}))}async deleteAccount(e){if(a.rY){if(await (0,a.G1)(1e3),!this.isAuthenticated())throw Error("User not authenticated");if(!e)throw Error("Password confirmation is required");return this.logout(),{message:"Account deleted successfully"}}let t=await (0,a.Uj)(()=>a.uE.delete("/users/delete-account",{password:e}));return this.logout(),t}checkPasswordStrength(e){let t=[],r=0;e.length<6?t.push("Password must be at least 6 characters long"):r+=1,e.length>=8&&(r+=1),/[a-z]/.test(e)&&/[A-Z]/.test(e)?r+=1:t.push("Include both uppercase and lowercase letters"),/\d/.test(e)?r+=1:t.push("Include at least one number"),/[!@#$%^&*(),.?":{}|<>]/.test(e)?r+=1:t.push("Include at least one special character");let a=["Very Weak","Weak","Fair","Good","Strong"][Math.min(r,4)];return r>=3&&t.unshift("Password strength: ".concat(a)),{score:r,feedback:t,isValid:r>=2&&e.length>=6}}startTokenRefresh(){setInterval(async()=>{if(this.isAuthenticated())try{await this.refreshToken()}catch(e){console.warn("Token refresh failed:",e)}},3e6)}constructor(){this.MOCK_ADMIN={email:"admin@lawvriksh.com",password:"admin123",user:{user_id:1,name:"Admin User",email:"admin@lawvriksh.com",created_at:new Date().toISOString(),total_points:0,shares_count:0,current_rank:null,is_admin:!0}}}}let o=new s}}]);